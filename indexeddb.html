<!DOCTYPE html>
<html>
    <body>
        <script>
            const dbReq = indexedDB.open('opentutorials', 1);
            let db;
            dbReq.addEventListener('success', function(event){
                db = event.target.result; // event.target = dbReq
            });
            dbReq.addEventListener('error', function(event){
                const error = event.target.error; 
                console.log('error', error.name);
            });            
            dbReq.addEventListener('upgradeneeded', function(event){ // version을 바꿀 때만 호출
                db = event.target.result;  
                // let oldVersion = event.oldVersion;
                // if(oldVersion < 1){
                    db.createObjectStore('topics', {keyPath:'id', autoIncrement:true}); //topic 생성은 upgradeneeded에서 하기!
                // } 
            });
        </script>
        
        <input type="button" value="add" onclick="
            let store = db.transaction('topics', 'readwrite').objectStore('topics');
            let addReq = store.add({
                title:prompt('title?'),
                body:prompt('body?')
            });
            addReq.addEventListener('success', function(event){
                console.log(event.target.result); // result는 추가한 오브젝트의 식별자(id)의 값
            });
        ">
        <input type="button" value="get" onclick="
            let id = Number(prompt('?id'));
            let store = db.transaction('topics', 'readonly').objectStore('topics');            
            let getReq = store.get(id);
            getReq.addEventListener('success', function(event){
                console.log(event.target.result); // result는 가져온 data
            });
        ">
        <input type="button" value="list" onclick="
            let store = db.transaction('topics', 'readonly').objectStore('topics');            
            let getAllReq = store.getAll();
            getAllReq.addEventListener('success', function(event){
                console.log(event.target.result); // result는 모든 data
            });
        ">
        <input type="button" value="update" onclick="
            let store = db.transaction('topics', 'readwrite').objectStore('topics');
            let putReq = store.put({
                id:Number(prompt('id?')),
                title:prompt('title?'),
                body:prompt('body?')
            });
            putReq.addEventListener('success',function(event){
                console.log(event);
            });
        ">
        <input type="button" value="delete" onclick="
            let store = db.transaction('topics', 'readwrite').objectStore('topics');
            let deleteReq = store.delete(Number(prompt('id?')));
            deleteReq.addEventListener('success', function(event){
                console.log(event);
            });
        ">        
    </body>
</html>